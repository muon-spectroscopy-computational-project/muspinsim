<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Theory of spin dynamics - II - MuSpinSim Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Theory of spin dynamics - II";
        var mkdocs_page_input_path = "theory_2.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> MuSpinSim Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Welcome to MuSpinSim's documentation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../theory_1/">Theory of spin dynamics - I</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Theory of spin dynamics - II</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#preparing-the-initial-state">Preparing the initial state</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#time-evolution">Time evolution</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#closed-system">Closed system</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integral-of-asymmetry">Integral of asymmetry</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#open-systems">Open systems</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-lindblad-master-equation">The Lindblad Master Equation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#a-simple-example">A simple example</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../hamiltonian/">Hamiltonian</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../input/">Input</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">MuSpinSim Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Theory of spin dynamics - II</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="theory-of-spin-dynamics-ii">Theory of spin dynamics - II</h1>
<h2 id="preparing-the-initial-state">Preparing the initial state</h2>
<p>When performing a simulation of a muon experiment, the first step is to prepare the system in an appropriate quantum state to evolve under the Hamiltonian. MuSpinSim uses the following rules to prepare this state:</p>
<ul>
<li>the muon is prepared in a state polarised along the direction of the beam (conventionally, the <em>x</em> axis in the laboratory frame of reference);</li>
<li>every other spin is prepared in a thermal density matrix state.</li>
</ul>
<p>A thermal density matrix state simply means a state in which every energy level is populated with a probability following the Boltzmann distribution, and fully decohered otherwise. In other words:</p>
<div class="arithmatex">\[
    \rho_{th}(T) = \frac{e^{-\frac{\mathcal{H}}{k_BT}}}{\mathrm{Tr}\left(e^{-\frac{\mathcal{H}}{k_BT}}\right)}
\]</div>
<p>where the trace below is the partition function of the system. 
One can see how finding this matrix would in principle require diagonalising the Hamiltonian of the whole system the muon is being inserted in. In practice, in MuSpinSim we use one of two approximations:</p>
<ul>
<li>by default, the <span class="arithmatex">\(T=\infty\)</span> approximation is used, in which all states are equally populated. The advantage of this approximation is that it's completely invariant to any change of basis - it doesn't make a difference what exactly the eigenstates of the Hamiltonian are. The real temperature of the sample, of course, is not infinite, but as long as <span class="arithmatex">\(k_BT \gg \mathcal{H}\)</span>, that's a fair enough approximation;</li>
<li>if requested by the user, finite temperature can be used, but the Hamiltonian is simplified to the Zeeman Hamiltonian, <span class="arithmatex">\(\mathcal{H} \approx \hbar \sum_i\gamma_i \mathbf{B}\mathbf{S}^{(i)}\)</span>.  This approximation keeps all spins independent from each other, ignoring their possible couplings, and is very effective in the case in which a strong magnetic field is applied and the Zeeman term is prevalent in the Hamiltonian. It should not be used for zero field experiment simulations.</li>
</ul>
<blockquote>
<p><strong>For developers:</strong> the initial density matrix is calculated in the property <code>.rho0()</code> of the class <code>ExperimentRunner</code>, found in <code>muspinsim/experiment.py</code>.</p>
</blockquote>
<h2 id="time-evolution">Time evolution</h2>
<h3 id="closed-system">Closed system</h3>
<p>Time evolution for the density matrix of a closed quantum system is controlled by the Liouville-von Neumann equation that we've already seen:</p>
<div class="arithmatex">\[
\frac{\partial \rho}{\partial t} = -\frac{i}{\hbar}[\mathcal{H}, \rho]
\]</div>
<p>If we write the matrix quantities with indices (repeated indices imply summation) we can write this as a system of coupled differential equations for each individual coefficient:</p>
<div class="arithmatex">\[
\frac{\partial \rho_{ij}}{\partial t} = -\frac{i}{\hbar}\left(\mathcal{H}_{ik}\rho_{kj}-\rho_{ik}\mathcal{H}_{kj}\right)
\]</div>
<p>This gets significantly simpler when we express both the matrices in a basis in which the Hamiltonian is diagonal, and thus <span class="arithmatex">\(\mathcal{H}_{ij} = \lambda_i\delta_{ij}\)</span>:</p>
<div class="arithmatex">\[
\frac{\partial \rho_{ij}}{\partial t} = -\frac{i}{\hbar}\rho_{ij}\left(\lambda_i-\lambda_j\right) 
\qquad
\implies
\qquad
\rho_{ij}(t) = e^{-\frac{i}{\hbar}\left(\lambda_i-\lambda_j\right) t}\rho_{ij}(0)
\]</div>
<p>This way we can see that the equations are completely decoupled. Coefficients on the diagonal of the density matrix don't change, while off-diagonal coefficients gain a phase factor at a constant rate that is dependent on the differences between the Hamiltonian eigenvalues. This method gives us the exact evolution of the system and perfectly preserves unitarity. The downside of it is that it requires a full diagonalization of the Hamiltonian. However, many spin systems that we are interested in are relatively small, and one single diagonalisation for each of them isn't a big deal. Cheaper, more approximate methods might be implemented in the future, but at the moment, MuSpinSim can easily carry out calculations on systems that don't exceed nine or ten spins on a laptop in a few minutes.</p>
<blockquote>
<p><strong>For developers:</strong> time evolution of a system is handled by the <code>.evolve()</code> method of the <code>Hamiltonian</code> class.</p>
</blockquote>
<h3 id="integral-of-asymmetry">Integral of asymmetry</h3>
<p>In muon experiments we're usually interested in measuring the asymmetry of positron hits between the forward and back detectors in the experimental setup - namely, the polarisation of the muon along a certain axis, as it evolves in time. However, in some cases (like ALC experiments) what we actually care about is the <em>integral</em> of this asymmetry throughout a certain time interval. This could be trivially computed simply by computing the time evolution and then integrating numerically. However MuSpinSim in this case uses a different algorithm to perform the integral analytically, saving some unnecessary steps. The full derivation of the formula is detailed in <a href="https://arxiv.org/abs/1704.02785">this arXiv paper</a>. The essence of it is that, if we have an operator <span class="arithmatex">\(S\)</span> with matrix elements <span class="arithmatex">\(s_{ij}\)</span> whose integral value we want to compute:</p>
<p>$$
\langle P \rangle = \int_0^\infty \langle S \rangle(t) e^{-\frac{t}{\tau}} dt
$$
where the integral is weighed with the decay process of the muon with lifetime <span class="arithmatex">\(\tau\)</span>, then we can define a new operator <span class="arithmatex">\(P\)</span> with matrix elements:</p>
<div class="arithmatex">\[
p_{ij} = \frac{s_{ij}}{\frac{1}{\tau}-\frac{i}{\hbar}\left(\lambda_i-\lambda_j\right)}
\]</div>
<p>and evaluating its expectation value on the initial state of the system will in a single pass return the value of the desired integral.</p>
<blockquote>
<p><strong>For developers:</strong> integral expectation values are handled by the <code>.integrate_decaying()</code> method of the <code>Hamiltonian</code> class.</p>
</blockquote>
<h2 id="open-systems">Open systems</h2>
<h3 id="the-lindblad-master-equation">The Lindblad Master Equation</h3>
<p>Systems described by the Liouville-von Neumann equation are closed; they conserve energy and evolve in a perfectly reversible way. This is sometimes not a good approximation, because in real life, the chunk of the sample that we're describing is of course only a small part of a much bigger system, fully coupled to it and interacting in a lot of ways. Since including an environment of hundreds or thousands of spins is not practical, a more common approach is to use a <em>master equation</em> that allows to describe irreversible evolution through some kind of energy exchange with environmental degrees of freedom.
In MuSpinSim, the only such master equation that is supported is the simplest one, the Lindblad equation. It is an extension of the Liouville-von Neumann equation including dissipative terms:</p>
<div class="arithmatex">\[
\frac{\partial \rho}{\partial t} = -\frac{i}{\hbar}[\mathcal{H}, \rho] + \sum_{i=1}^{N^2-1}\alpha_i\left(L_i \rho L_i^\dagger - \frac{1}{2}\left\{L_i^\dagger L_i, \rho\right\} \right)
\]</div>
<p>Here the <span class="arithmatex">\(\alpha_i\)</span> are coefficients that express the strength of the coupling with a certain degree of freedom, and the <span class="arithmatex">\(L_i\)</span> are the so-called Lindblad or jump operators of the system, each connected to one coefficient. The curly braces denote the <em>anticommutator</em> of two matrices: <span class="arithmatex">\(\{A, B\} = AB+BA\)</span>.</p>
<p>This equation unfortunately does not have a neat solution in exponential form as the one seen above in the matrix formalism. It is however possible to find something very close to it by making a few small changes in the representation, namely, expressing the density matrix in what is called the <em>Fock-Liouville space</em>. An excellent and detailed explanation of this technique is given in this <a href="https://arxiv.org/abs/1906.04478">useful introductory paper by Daniel Manzano</a>. The essence of it is that we "straighten up" the density matrix, writing all its elements in a single column vector. For example, a <span class="arithmatex">\(4\times 4\)</span> matrix can turn into a <span class="arithmatex">\(16\)</span> elements column vector. It is then possible to write a matrix called the Lindbladian (that in the example will be <span class="arithmatex">\(16 \times 16\)</span>) that operates on it exactly like a Hamiltonian does on a single wavefunction:</p>
<div class="arithmatex">\[
\frac{\partial}{\partial t} \mid \rho \rangle\rangle = \mathcal{L} \mid \rho \rangle\rangle
\]</div>
<p>and following from that, it is possible to integrate the equations as trivially as seen for the others by diagonalising the Lindbladian. Care must be taken though because unlike for the Hamiltonian, there is no guarantee that the Lindbladian is Hermitian, or for that matter, diagonalizable at all! This can potentially cause issues - however in my experience well-defined systems will be solvable without problems.</p>
<p>In MuSpinSim, the only way dissipation can be included in a calculation is by putting an individual spin in contact with a thermal reserve. This is done by defining two jump operators for that spin, <span class="arithmatex">\(S_+^i\)</span> and <span class="arithmatex">\(S_-^i\)</span>, and the corresponding dissipation coefficients such that</p>
<div class="arithmatex">\[
\frac{\alpha_+^i}{\alpha_-^i} = \exp\left(-\frac{\hbar\gamma |B|}{k_BT}\right)
\]</div>
<p>where <span class="arithmatex">\(T\)</span> is the temperature of the system, and <span class="arithmatex">\(\hbar\gamma|B|\)</span> is an approximation using only the Zeeman interaction of the energy gap between successive states of the spin. For <span class="arithmatex">\(T &lt; \infty\)</span>, this is subject to the same limits as the choice of using only the Zeeman interaction to define the initial thermal state density matrix. In fact, the effect of these terms is to tend to drive the individual spin's state towards exactly that thermal state, adding or removing energy as needed and erasing coherences.</p>
<blockquote>
<p><strong>For developers:</strong> the <code>Lindbladian</code> class is defined in <code>muspinsim/lindbladian.py</code>. It has <code>.evolve()</code> and <code>.integrate_decaying()</code> methods analogous to those of the <code>Hamiltonian</code> class.</p>
</blockquote>
<h3 id="a-simple-example">A simple example</h3>
<p>Let's look at a basic example of a problem that can be solved analytically with the Lindblad master equation to see how it works. Let's consider a single muon immersed in a magnetic field <span class="arithmatex">\(B\)</span> such that it has Larmor frequency <span class="arithmatex">\(\omega_L = \gamma_\mu B\)</span>. It is prepared in a state polarised along <span class="arithmatex">\(x\)</span>, so the initial density matrix is</p>
<div class="arithmatex">\[
\rho_0 = \begin{bmatrix}
\frac{1}{2} &amp; \frac{1}{2} \\
\frac{1}{2} &amp; \frac{1}{2}
\end{bmatrix}
\]</div>
<p>and is coupled to an environment with infinite temperature (so <span class="arithmatex">\(\alpha_+ = \alpha_- = \alpha\)</span>). The Hamiltonian for this system will then be:</p>
<div class="arithmatex">\[
\mathcal{H} = \hbar \omega_L S_z
\]</div>
<p>and the jump operators are </p>
<div class="arithmatex">\[
S_+ = \begin{bmatrix}
0 &amp; 1 \\
0 &amp; 0
\end{bmatrix}
\qquad
S_- = \begin{bmatrix}
0 &amp; 0 \\
1 &amp; 0
\end{bmatrix}.
\]</div>
<p>Let's write the Lindblad master equation in full:</p>
<div class="arithmatex">\[
\begin{align*}
\frac{\partial \rho}{\partial t} = &amp;i\omega_L(\rho S_z-S_z\rho) + \\
&amp; \alpha\left(S_+ \rho S_- + S_- \rho S_+ - \frac{1}{2}S_+S_-\rho - \frac{1}{2} S_-S_+\rho - \frac{1}{2} \rho S_+S_- - \frac{1}{2} \rho S_-S_+ \right)
\end{align*}
\]</div>
<p>where we made use of the fact that <span class="arithmatex">\(S_+^\dagger = S_-\)</span> and vice versa. If we write <span class="arithmatex">\(\rho\)</span> in terms of its components and expand the products, keeping in mind that it has to be Hermitian, we get:</p>
<div class="arithmatex">\[
\frac{\partial}{\partial t}\begin{bmatrix}
\rho_{11} &amp; \rho_{12} \\
\rho_{12}^* &amp; \rho_{22}
\end{bmatrix} = 
i \omega_L \begin{bmatrix}
0 &amp; -r_{12} \\
r_{12}^* &amp; 0
\end{bmatrix}
+\alpha
\left(
\begin{bmatrix}
\rho_{22} &amp; 0 \\
0 &amp; \rho_{11}
\end{bmatrix}
- \begin{bmatrix}
\rho_{11} &amp; \rho_{12} \\
\rho_{12}^* &amp; \rho_{22}
\end{bmatrix}
\right)
\]</div>
<p>We can then expand this in three differential equations (we leave out the fourth one as it's just the complex conjugate of one of the others):</p>
<div class="arithmatex">\[
\begin{align*}
\frac{\partial \rho_{11}}{\partial t} = &amp; \alpha(\rho_{22}-\rho_{11}) \\
\frac{\partial \rho_{22}}{\partial t} = &amp; \alpha(\rho_{11}-\rho_{22}) \\
\frac{\partial \rho_{12}}{\partial t} = &amp; -i\omega_L \rho_{12} -\alpha\rho_{12}
\end{align*}
\]</div>
<p>which combined with the initial conditions from the starting density matrix lead to the solutions:</p>
<div class="arithmatex">\[
\begin{align*}
\rho_{11}(t) = &amp; \rho_{22}(t) = \frac{1}{2} \\
\rho_{12}(t) = &amp; \frac{1}{2}e^{-i\omega_Lt -\alpha t}
\end{align*}
\]</div>
<p>In other words, the evolution has an oscillating phase on the off-diagonal elements plus an exponential decay which brings them down to zero, as the interactions with the environment cause decoherence.</p>
<p>In the <a href="../hamiltonian/">next section</a> we will look specifically at the exact shape of the terms of the Hamiltonian (and when necessary, Lindbladian) used in MuSpinSim.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../theory_1/" class="btn btn-neutral float-left" title="Theory of spin dynamics - I"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../hamiltonian/" class="btn btn-neutral float-right" title="Hamiltonian">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../theory_1/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../hamiltonian/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../js/config.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
